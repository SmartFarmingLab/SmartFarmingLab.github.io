<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Batch Map</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />

    <!-- Custom Styles -->
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f4;
        }

        #map {
            height: 100vh;
            width: 100%;
            border-radius: 10px;
        }

        /* Custom popup styling */
        .leaflet-popup-content {
            font-size: 16px;
            color: #333;
        }

        .leaflet-popup-content b {
            color: #6ed391;
        }

        /* Marker styling */
        .custom-marker {
            background-color: #6ed391;
            border-radius: 50%;
            width: 14px;
            height: 14px;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 3px solid white;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body>

    <div id="map"></div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    
    <script>
        // Initialize Map
       var map = L.map('map', { zoomControl: false }).setView([51.1657, 10.4515], 6); // Center in Germany
       //  var map = L.map('map', { zoomControl: true });



        // Load Tile Layer (Modern Styling)
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; OpenStreetMap & Carto',
            subdomains: 'abcd',
            maxZoom: 20
        }).addTo(map);

        // Fetch and process product batch steps from data.json
        fetch("https://smartfarminglab.github.io/data/productpassport.json")
            .then(response => response.json())
            .then(data => {
                const productBatchSteps = data.productBatchSteps.map(step => ({
                    name: step.name,
                    latitude: step.address.latitude,
                    longitude: step.address.longitude,
                    address: `${step.address.name}, ${step.address.city}`,
                    nextStepId: step.nextStepId
                }));

                // Add markers and connect steps
                let polylinePoints = [];
                productBatchSteps.forEach((step, index) => {
                    var marker = L.marker([step.latitude, step.longitude], {
                        icon: L.divIcon({
                            className: 'custom-marker',
                            html: `<div></div>`,
                            iconSize: [14, 14],
                            popupAnchor: [0, -10]
                        })
                    }).addTo(map)
                      .bindPopup(`<b>${step.name}</b><br>${step.address}`);

                    // Add to polyline path
                    polylinePoints.push([step.latitude, step.longitude]);
                });

                // Draw polyline connecting the batch steps with a modern look
                L.polyline(polylinePoints, {
                    color: "#6ed391",
                    weight: 4,
                    opacity: 0.8,
                    dashArray: "5, 10",
                    lineJoin: "round"
                }).addTo(map);
            })
            .catch(error => console.error("Error loading data:", error));
    </script>

</body>
</html>
