<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HerkunftCheck</title>
    <link rel="icon" type="image/x-icon" href="img/tab_icon.png">



    <link rel="stylesheet" href="style/style.css" />
    <link rel="stylesheet" href="style/map.css" />
    <link rel="stylesheet" href="style/card.css" />
    <link rel="stylesheet" href="style/sidebar.css" />


    <!-- Font CSS -->

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Boldonse&family=Fira+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet">


    <!-- Leaflet CSS -->
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

    <!-- Polyline Decorator (if needed) -->
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-polylinedecorator/1.6.0/leaflet.polylineDecorator.min.js"></script>

    <!-- ✅ Working Leaflet.curve plugin -->
    <script src="https://rawcdn.githack.com/elfalem/Leaflet.curve/master/src/leaflet.curve.js"></script>

    <!-- MarkerCluster CSS & JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>



    <script src="script/map.js"></script>




    <script>

        document.addEventListener("DOMContentLoaded", function () {
            InitializeMapAndData();
        });




        function showSidebarWithStep(step) {
            document.getElementById('sidebar').style.display = 'block';
            document.getElementById('step-name').textContent = step.name || "-";
            document.getElementById('step-location').textContent = step.address?.name || "-";
            document.getElementById('step-street').textContent = step.address?.street || "-";
            document.getElementById('step-zipcity').textContent = `${step.address?.zip || ""} ${step.address?.city || ""}`;
            document.getElementById('step-country').textContent = step.address?.country || "-";

            // Optional: StepEntries (z. B. Datum, Menge, Energie, CO2)
            const entry = step.stepEntries && step.stepEntries[0];
            document.getElementById('step-date').textContent = entry?.date ? new Date(entry.date).toLocaleDateString("de-DE") : "-";
            document.getElementById('step-amount').textContent = entry?.amount && entry?.amountUnit ? `${entry.amount} ${entry.amountUnit}` : "-";
            document.getElementById('step-energy').textContent = entry?.energyConsumption || "-";
            document.getElementById('step-co2').textContent = entry?.co2Emission || "-";
            

            if(step.imageSrc !== "string"){
                document.getElementById('top-image').style.backgroundImage = "url('" + step.imageSrc + "')";
            }
         


        }

        // Event Listener zum Schließen der Seitenleiste
        window.addEventListener("DOMContentLoaded", () => {
            document.getElementById("sidebar-close").addEventListener("click", () => {
                document.getElementById("sidebar").style.display = "none";
            });
        });
    </script>

</head>

<body>




    <!-- Product Information Card -->
    <div id="product-card">
        <div id="product-info">
            <h1 id="product-name">Laden...</h2>
                <p><strong>Kategorie:</strong> <span id="product-category"></span></p>
                <p><strong>Produktionsdatum:</strong> <span id="production-date"></span></p>
                <p><strong>MHD:</strong> <span id="best-before"></span></p>
                <p><strong>Produzent:</strong> <span id="company-name"></span></p>
                <div class="certificate-images" id="certificates"></div>
        </div>
        <img id="product-image" class="logo" src="img/logo_icon.png" alt="Product Image">
    </div>


    <div id="sidebar" class="modern-sidebar">

        <div class="card-hover">
            <button id="sidebar-close" title="Schließen">&#8592;</button>
            <div class="card-hover__content">
                <h3 class="card-hover__title" id="step-name">
                    Schrittname
                </h3>

                <div class="card-hover__content-2">
                    <h4 class="card-hover__title" id="">
                        Einträge
                        </h3>
                        <div class="info-panel-data">
                            <div class="sidebar-content card-hover__text">
                                <div class="sidebar-row">
                                    <span class="label">Ort:</span>
                                    <span class="value" id="step-location"></span>
                                </div>
                                <div class="sidebar-row">
                                    <span class="label">Straße:</span>
                                    <span class="value" id="step-street"></span>
                                </div>
                                <div class="sidebar-row">
                                    <span class="label">PLZ & Stadt:</span>
                                    <span class="value" id="step-zipcity"></span>
                                </div>
                                <div class="sidebar-row">
                                    <span class="label">Land:</span>
                                    <span class="value" id="step-country"></span>
                                </div>
                                <div class="sidebar-row">
                                    <span class="label">Datum:</span>
                                    <span class="value" id="step-date"></span>
                                </div>
                                <div class="sidebar-row">
                                    <span class="label">Menge:</span>
                                    <span class="value" id="step-amount"></span>
                                </div>
                                <div class="sidebar-row">
                                    <span class="label">Energieverbrauch:</span>
                                    <span class="value" id="step-energy"></span>
                                </div>
                                <div class="sidebar-row">
                                    <span class="label">CO₂-Ausstoß:</span>
                                    <span class="value" id="step-co2"></span>
                                </div>
                            </div>
                        </div>

                        <div class="step-entries">




                        </div>

                </div>
            </div>








            <div id="top-image" class="top-image" style="background-image: url('img/example.jpg');">

            </div>







        </div>

    </div>
    </div>




    </div>





    <div id="map"></div>
</body>

</html>